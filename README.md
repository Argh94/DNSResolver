# DnsResolved

**DnsResolved** یک پروژه پایتون برای پیدا کردن آدرس‌های IP (IPv4 و IPv6) دامنه‌ها با استفاده از پروتکل DNS است. این پروژه شامل دو نسخه کد است:
1. **نسخه اصلی** (`raw_dns_resolver.py`): با سوکت‌های خام و بدون نیاز به کتابخانه خارجی.
2. **نسخه با dnspython** (`dnspython_resolver.py`): با استفاده از کتابخانه `dnspython` برای سادگی و قابلیت اطمینان بیشتر.

هر دو نسخه از ویژگی‌های مشابهی مثل اعتبارسنجی دامنه، تلاش دوباره (retry)، و اجرای همزمان پشتیبانی می‌کنند، اما روش پیاده‌سازی آن‌ها متفاوت است.

## نویسنده
این پروژه توسط **argh94** نوشته شده است.

## عملکرد پروژه
هر دو نسخه این پروژه:
- از کاربر سه دامنه (مانند google.com) می‌گیرند.
- برای هر دامنه، آدرس‌های IPv4 (رکورد A) و IPv6 (رکورد AAAA) را از سرور DNS (پیش‌فرض: 1.1.1.1 از Cloudflare) پیدا می‌کنند.
- دامنه‌ها را قبل از ارسال اعتبارسنجی می‌کنند تا مطمئن شوند معتبرند.
- از threading برای پردازش همزمان سه دامنه استفاده می‌کنند.
- اگر سرور DNS پاسخ ندهد، تا ۳ بار دوباره امتحان می‌کنند (retry).
- نتایج را به‌صورت مرتب نمایش می‌دهند (مثلاً آدرس IP یا پیام خطا).

### تفاوت‌های نسخه‌ها

| ویژگی                 | raw_dns_resolver.py (بدون کتابخانه)             | dnspython_resolver.py (با dnspython)                |
|-----------------------|--------------------------------------------------|-----------------------------------------------------|
| **روش پیاده‌سازی**    | استفاده از سوکت‌های خام (UDP) و کتابخانه‌های استاندارد پایتون | استفاده از کتابخانه `dnspython` برای مدیریت DNS   |
| **پیچیدگی کد**        | پیچیده‌تر، بسته‌های DNS را دستی می‌سازد و تجزیه می‌کند | ساده‌تر، چون `dnspython` همه‌چیز را خودکار انجام می‌دهد |
| **وابستگی**           | بدون نیاز به نصب کتابخانه خارجی                  | نیاز به نصب `dnspython` (`pip install dnspython`)  |
| **مدیریت خطاها**      | محدود، ممکن است با پاسخ‌های پیچیده DNS مشکل داشته باشد | قوی‌تر، خطاها و پاسخ‌های پیچیده را بهتر مدیریت می‌کند |
| **پشتیبانی از رکوردها**| فقط A (IPv4) و AAAA (IPv6)                       | پشتیبانی از انواع رکوردها (A، AAAA، MX، CNAME و ...) |
| **مناسب برای**        | یادگیری پروتکل DNS، محیط‌های بدون وابستگی        | پروژه‌های عملی، کد تمیزتر و نگهداری راحت‌تر        |
| **حجم کد**            | طولانی‌تر (نیاز به توابع دستی برای ساخت و تجزیه)  | کوتاه‌تر (چون `dnspython` منطق DNS را مدیریت می‌کند) |

**چه زمانی کدام نسخه را استفاده کنیم؟**
- اگر می‌خواهید پروتکل DNS را یاد بگیرید یا در محیطی هستید که نمی‌توانید کتابخانه نصب کنید، از `raw_dns_resolver.py` استفاده کنید.
- اگر کد ساده‌تر، قابل‌اعتمادتر و آماده برای پروژه‌های بزرگ‌تر می‌خواهید، از `dnspython_resolver.py` استفاده کنید.

## قسمت‌های مهم کد

### ۱. raw_dns_resolver.py
- **کلاس `DNSResolver`**:
  - `__init__`: تنظیمات اولیه (تعداد تلاش‌ها، Semaphore برای threading و Lock برای thread-safety)
  - `is_valid_domain`: اعتبارسنجی دامنه با regex
  - `build_dns_query`: ساخت بسته DNS برای درخواست A یا AAAA
  - `parse_dns_response`: تجزیه پاسخ DNS برای استخراج آدرس IP
  - `resolve_domain`: ارسال درخواست به سرور DNS و ذخیره نتایج
- **تابع `main`**: گرفتن سه دامنه از کاربر، اجرای threadها و نمایش نتایج

### ۲. dnspython_resolver.py
- **کلاس `SimpleDNSResolver`**:
  - `__init__`: تنظیمات اولیه (پیکربندی `dns.resolver.Resolver`، سرور DNS و تایم‌اوت)
  - `is_valid_domain`: اعتبارسنجی دامنه با regex
  - `resolve_domain`: استفاده از `dnspython` برای رفع نام دامنه و مدیریت خطاها
- **تابع `main`**: مشابه نسخه اصلی، ورودی می‌گیرد، threadها را اجرا می‌کند و نتایج را نمایش می‌دهد

## وابستگی‌ها

- **`raw_dns_resolver.py`**: بدون وابستگی خارجی، فقط از کتابخانه‌های استاندارد پایتون استفاده می‌کند:
  - `socket` برای ارتباط شبکه‌ای
  - `struct` برای بسته‌بندی و باز کردن داده‌های DNS
  - `threading` برای اجرای همزمان
  - `random` برای تولید شناسه تراکنش تصادفی
  - `re` برای اعتبارسنجی دامنه

- **`dnspython_resolver.py`**: نیاز به نصب کتابخانه `dnspython` دارد:
```bash
pip install dnspython
```

## نیازمندی‌ها

- پایتون: نسخه ۳.۶ یا بالاتر
- دسترسی به اینترنت: برای ارتباط با سرور DNS (پیش‌فرض: 1.1.1.1 از Cloudflare)
- (اختیاری) افزونه cSpell در ویرایشگر کد (مثل VS Code) برای استفاده از فایل .cspell.json

## ساختار پروژه

```
DnsResolved/
├── raw_dns_resolver.py    # نسخه اصلی با سوکت‌های خام
├── dnspython_resolver.py  # نسخه با کتابخانه dnspython
├── .cspell.json           # تنظیمات cSpell برای کلمات تخصصی
├── README.md              # توضیحات پروژه (این فایل)
├── requirements.txt       # وابستگی‌ها (برای dnspython)
└── .gitignore             # فایل‌های مستثنی از آپلود
```

### فایل تنظیمات پروژه

#### .cspell.json
این فایل برای ابزار cSpell (بررسی املای کلمات در کد) تنظیم شده و کلمات تخصصی مربوط به DNS را تعریف می‌کند تا به‌عنوان غلط املایی نمایش داده نشوند:
```json
{
    "cSpell.words": [
        "ancount",
        "arcount",
        "nscount",
        "qdcount",
        "qtype",
        "rdlength",
        "SOCK_DGRAM",
        "AAAA",
        "NXDOMAIN"
    ]
}
```
کلماتی مثل SOCK_DGRAM و qdcount در raw_dns_resolver.py و NXDOMAIN در dnspython_resolver.py استفاده شده‌اند.

#### requirements.txt
شامل وابستگی برای نسخه dnspython_resolver.py:
```
dnspython>=2.4.0
```

#### .gitignore
فایل‌های غیرضروری را از آپلود به گیت‌هاب مستثنی می‌کند:
```
__pycache__/
*.pyc
*.log
```

## نصب و اجرا

### کلون کردن پروژه:
```bash
git clone https://github.com/argh94/DnsResolved.git
cd DnsResolved
```

### نصب وابستگی (برای dnspython_resolver.py):
```bash
pip install -r requirements.txt
```

### اجرای برنامه:

برای نسخه اصلی (بدون نیاز به نصب چیزی):
```bash
python raw_dns_resolver.py
```

برای نسخه با dnspython:
```bash
python dnspython_resolver.py
```

### ورودی و خروجی:
برنامه از شما سه دامنه می‌خواهد (مانند google.com).  
برای هر دامنه، آدرس‌های IPv4 و IPv6 (در صورت وجود) نمایش داده می‌شود.

#### مثال اجرا

ورودی:
```
دامنه 1 را وارد کنید: google.com
دامنه 2 را وارد کنید: example.com
دامنه 3 را وارد کنید: invalid@domain
```

خروجی احتمالی (مشابه برای هر دو نسخه):
```
آدرس IP برای google.com (A): 142.250.190.14
آدرس IP برای google.com (AAAA): 2607:f8b0:4004:831::200e
آدرس IP برای example.com (A): 93.184.216.34
آدرس IP برای example.com (AAAA): پاسخی دریافت نشد
آدرس IP برای invalid@domain (A): نام دامنه نامعتبر است
آدرس IP برای invalid@domain (AAAA): نام دامنه نامعتبر است
```

## فورک پروژه

اگر می‌خواهید پروژه را فورک کنید و تغییراتی دهید:
1. به https://github.com/argh94/DnsResolved بروید و روی Fork کلیک کنید.
2. مخزن را کلون کنید:
```bash
git clone https://github.com/YourUsername/DnsResolved.git
```
(به‌جای YourUsername، نام کاربری خودتان را وارد کنید.)

3. تغییرات را اعمال و push کنید:
```bash
git add .
git commit -m "تغییرات من"
git push origin main
```
4. برای پیشنهاد تغییرات به مخزن اصلی، یک Pull Request بفرستید.

## توسعه آینده

- اضافه کردن پشتیبانی از سرورهای DNS دیگر (مثل 8.8.8.8 از گوگل)
- پشتیبانی از رکوردهای بیشتر (مثل MX، CNAME یا TXT) در نسخه dnspython_resolver.py
- ذخیره نتایج در فایل (مثل JSON یا CSV)
- اضافه کردن رابط کاربری گرافیکی (مثلاً با tkinter)
- بهبود مدیریت خطاها برای پاسخ‌های پیچیده DNS در نسخه raw_dns_resolver.py

## لایسنس

این پروژه تحت MIT License (LICENSE) منتشر شده است.

## تماس

برای سؤال یا پیشنهاد، با argh94 از طریق گیت‌هاب تماس بگیرید.

## تشکر

ممنون که از پروژه DnsResolved استفاده می‌کنید! اگر نظری دارید، خوشحال می‌شویم بشنویم.
